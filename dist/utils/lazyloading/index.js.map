{"version":3,"file":"index.js","sources":["../../../utils/lazyloading/index.js"],"sourcesContent":["import { element, hooks } from 'wp';\n\nconst {\n    cloneElement,\n    Children: { map: mapChildren },\n} = element;\nconst { addFilter } = hooks;\n\nconst processedBlockTypes = [\n    'core/image',\n    // 'core/embed',\n    // 'core-embed/twitter',\n    // 'core-embed/youtube',\n    // 'core-embed/instagram',\n    // 'core-embed/vimeo',\n];\n\nconst initLazyload = function (element, blockType) {\n    if (processedBlockTypes.findIndex((el) => el === blockType.name) > -1) {\n        const newChildren = mapChildren(\n            element.props.children,\n            recurseChildren\n        );\n        const newProps = {\n            ...element.props,\n            children: newChildren,\n        };\n\n        return cloneElement(element, newProps);\n    } else {\n        return element;\n    }\n};\n\nconst recurseChildren = (child) => {\n    if (!child) return;\n    if (child.type === 'img' || child.type === 'iframe') {\n        return cloneElement(child, {\n            loading: 'lazy',\n        });\n    } else if (child.props && child.props.children) {\n        return cloneElement(child, {\n            children: mapChildren(child.props.children, recurseChildren),\n        });\n    }\n    return child;\n};\n\nexport function lazyLoadImages() {\n    addFilter('blocks.getSaveElement', 'ghwp/lazyloading', initLazyload);\n}\n"],"names":["cloneElement","element","mapChildren","Children","map","addFilter","hooks","processedBlockTypes","initLazyload","blockType","findIndex","el","name","newChildren","props","children","recurseChildren","newProps","child","type","loading","lazyLoadImages"],"mappings":";;;AAEA,IACIA,YADJ,GAGIC,OAHJ,CACID,YADJ;AAAA,IAEqBE,WAFrB,GAGID,OAHJ,CAEIE,QAFJ,CAEgBC,GAFhB;AAIA,IAAQC,SAAR,GAAsBC,KAAtB,CAAQD,SAAR;AAEA,IAAME,mBAAmB,GAAG,CACxB,YADwB;AAGxB;AACA;AACA;AACA;AANwB,CAA5B;;AASA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAAUP,OAAV,EAAmBQ,SAAnB,EAA8B;AAC/C,MAAIF,mBAAmB,CAACG,SAApB,CAA8B,UAACC,EAAD;AAAA,WAAQA,EAAE,KAAKF,SAAS,CAACG,IAAzB;AAAA,GAA9B,IAA+D,CAAC,CAApE,EAAuE;AACnE,QAAMC,WAAW,GAAGX,WAAW,CAC3BD,OAAO,CAACa,KAAR,CAAcC,QADa,EAE3BC,eAF2B,CAA/B;;AAIA,QAAMC,QAAQ,qCACPhB,OAAO,CAACa,KADD;AAEVC,MAAAA,QAAQ,EAAEF;AAFA,MAAd;;AAKA,WAAOb,YAAY,CAACC,OAAD,EAAUgB,QAAV,CAAnB;AACH,GAXD,MAWO;AACH,WAAOhB,OAAP;AACH;AACJ,CAfD;;AAiBA,IAAMe,eAAe,GAAG,SAAlBA,eAAkB,CAACE,KAAD,EAAW;AAC/B,MAAI,CAACA,KAAL,EAAY;;AACZ,MAAIA,KAAK,CAACC,IAAN,KAAe,KAAf,IAAwBD,KAAK,CAACC,IAAN,KAAe,QAA3C,EAAqD;AACjD,WAAOnB,YAAY,CAACkB,KAAD,EAAQ;AACvBE,MAAAA,OAAO,EAAE;AADc,KAAR,CAAnB;AAGH,GAJD,MAIO,IAAIF,KAAK,CAACJ,KAAN,IAAeI,KAAK,CAACJ,KAAN,CAAYC,QAA/B,EAAyC;AAC5C,WAAOf,YAAY,CAACkB,KAAD,EAAQ;AACvBH,MAAAA,QAAQ,EAAEb,WAAW,CAACgB,KAAK,CAACJ,KAAN,CAAYC,QAAb,EAAuBC,eAAvB;AADE,KAAR,CAAnB;AAGH;;AACD,SAAOE,KAAP;AACH,CAZD;;AAcO,SAASG,cAAT,GAA0B;AAC7BhB,EAAAA,SAAS,CAAC,uBAAD,EAA0B,kBAA1B,EAA8CG,YAA9C,CAAT;AACH;;;;"}